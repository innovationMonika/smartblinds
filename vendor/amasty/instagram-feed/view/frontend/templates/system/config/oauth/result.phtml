<?php
/**
* @author Amasty Team
* @copyright Copyright (c) 2022 Amasty (https://www.amasty.com)
* @package Instagram Feed for Magento 2
*/
?>
<?php
/**
 * @var \Amasty\InstagramFeed\Block\Adminhtml\System\Config\Oauth\Result $block
 * @var \Magento\Framework\Escaper $escaper
 */
?>
<script>
    window
        .opener
        .document
        .getElementById('aminstagramfeed_credentials_test_connect')
        .textContent = "<?= $escaper->escapeHtml($block->getButtonMessage()) ?>";

    window
        .opener
        .document
        .getElementById('row_aminstagramfeed_credentials_user_id')
        .getElementsByClassName('control-value')[0]
        .textContent = "<?= $escaper->escapeHtml($block->getUserId()) ?>";

    <?php if ($block->isTokenGenerated()): ?>
        <?php if ($block->isGenerateImagesEnabled()): ?>
        window
            .opener
            .document
            .getElementById('aminstagramfeed_credentials_generate_images')
            .removeAttribute('disabled');
        <?php endif; ?>

        window
            .opener
            .document
            .getElementById('aminstagramfeed_credentials_access_token_new')
            .value = "<?= $escaper->escapeHtml($block->getAccessToken()) ?>";

        window.opener.document.isTokenGenerated = true;
    <?php else: ?>
        window.opener.document.errorText = "<?=/* @noEscape */ $block->getErrorMessage(); ?>"
    <?php endif; ?>

    window.close();
</script>
