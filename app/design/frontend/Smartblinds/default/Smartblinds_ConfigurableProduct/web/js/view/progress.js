define(["jquery","underscore","mage/translate","mage/mage","domReady!"],function(t,c,s){"use strict";var d=t(window);return t(".product-options-wrapper .pdp-options-save-button .btn").on("click",function(i){let o=t('.width-height-option .control input[data-role="width"]'),e=t('.width-height-option .control input[data-role="height"]');o.length>0&&e.length>0&&!o.val()&&!e.val()&&(o.focus(),o.blur())}),t(function(){setTimeout(function(){t(window).trigger("swatches-click")},1500)}),t.widget("mage.progressButton",{options:{progressButtonSelector:"[data-role=progress-button]",progressStepSelector:"[data-role=step]",boxToCartBottomSelector:"[data-role=box-tocart-bottom]",addToCartButtonSelector:".action.tocart",productTopOptionSelector:".product-option.top",productInfoDiscountMessageSelector:"[data-role=product-info-discount-message]",addToCartQtySelector:"[data-role=addtocart-qty]",textualOptionSelector:".product-option.textual",configuratorDescriptionSelector:"[data-role=configurator-description]",priceLabelSelector:".price-label",choicesSelector:"[data-role=choices]",choicesSwiper:".choices-swiper.swiper-container",swatchOptionsSelector:'div[data-role="swatch-options"]',addToCartTopContainer:".product-add-form .product-addtocart-top-block",addToCartBottomContainer:".product-add-form .product-options-bottom",widthFieldSelector:"input[data-role=width]",heightFieldSelector:"input[data-role=height]"},_create:function(){this.$progressButton=t(this.options.progressButtonSelector),this.$priceLabel=t(this.options.priceLabelSelector),this.$widthField=t(this.options.widthFieldSelector),this.$heightField=t(this.options.heightFieldSelector),this.$progressButton.click(this._startConfiguration.bind(this)),this.isConfigurePage=t("body").hasClass("checkout-cart-configure"),this.isConfigurePage&&this.$progressButton.click()},_startConfiguration:function(){if(!(!this.isConfigurePage&&(!this.$widthField.valid()||!this.$heightField.valid()))){this.$progressButton.text(s("Update dimensions")),this.$progressButton.addClass("progress-btn"),t(this.options.addToCartTopContainer).addClass("progress"),t(this.options.addToCartBottomContainer).addClass("progress"),t(this.options.boxToCartBottomSelector).addClass("completed");var i=[t(this.options.addToCartQtySelector),t(this.options.boxToCartBottomSelector),t(this.options.configuratorDescriptionSelector),t(this.options.productInfoDiscountMessageSelector),t(this.options.addToCartButtonSelector)];c.each(i,function(o){o.show()}),this.$priceLabel.text(s("Your price")),this.updateSteps(),d.on("update-steps",this.updateSteps.bind(this)),d.on("updatePrice",this.updateSteps.bind(this)),this.$progressButton.unbind("click"),this.$progressButton.click(this._updateConfiguration.bind(this))}},_updateConfiguration:function(){let i=t('.mageworx-swatch-option[data-option-code="montage"]'),o=i.length;if(o>0){let e=0,n=!1;for(e=0;e<o;e++)i.eq(e).hasClass("selected")&&(n=!0);let r=t('.product-option-header label[for="select_'+i.eq(0).attr("data-option-id")+'"]').parent().parent();if(n===!1)r.find(".control .mage-error").length===0&&(r.find(".control").prepend('<div class="mage-error" generated="true"></div>'),r.find(".control .mage-error").text(s("Please pick a installation type to configure your product.")));else if(r.find(".control .mage-error").length>0)r.find(".control .mage-error").remove();else{let a=t('.width-height-option .control input[data-role="width"]'),p=t('.width-height-option .control input[data-role="height"]');a.length>0&&p.length>0&&!a.val()&&!p.val()&&(a.focus(),a.blur())}}},updateSteps:function(){if(!this.stepsUpdated){var i=t(this.options.progressStepSelector);c.each(i,function(e){var n=t(e);n.show()}.bind(this)),window.dispatchEvent(new Event("scroll")),d.trigger("load-choices");var o=[t(this.options.textualOptionSelector),t(this.options.choicesSelector),t(this.options.choicesSwiper)];c.each(o,function(e){e.show()}),this.$priceLabel.text(s("Your total price")),this.stepsUpdated=!0}},isStepCompleted:function(i){return Boolean(i.find(".selected").length)}}),t.mage.progressButton});
