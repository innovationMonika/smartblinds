define(["jquery","underscore","Magento_Swatches/js/swatch-renderer/selected-attributes/by-product-id","Magento_Swatches/js/swatch-renderer/selected-attributes/validate","Magento_Swatches/js/swatch-renderer/selected-attributes/first-available","Magento_Swatches/js/swatch-renderer/selected-attributes/update-url","getSwatchSelectedProductId"],function(o,m,T,M,A,L,j){"use strict";const S=o(window),C=767;let v=!1,B=!1;var R={_create:function(){this._super(),this._setupResizeEventForGallery(),this._onClickEventForMobileGallery(),this._onClickEventForMobileChoicesGallery()},_setupResizeEventForGallery:function(){S.width()>C||S.on("resize",()=>{!v&&S.width()>C&&(this._LoadProductMedia(),v=!0)})},_onClickEventForMobileGallery:function(){var t=this;o(".js-product-media-swiper").on("click",".swiper-slide",function(){v||(t._LoadProductMedia(),v=!0)})},_onClickEventForMobileChoicesGallery:function(){var t=this;o(".choices-swiper").on("click",".swiper-slide",function(){v||(t._LoadProductMedia(),v=!0)})},_OnClick:function(t,e){var i=t.parents("."+e.options.classes.attributeClass),a=i.data("attribute-id"),s=i.find("."+e.options.classes.attributeInput);if(s.attr("data-attr-name")||s.attr("data-attr-name",this._getAttributeCodeById(a)),t.hasClass("selected"))return;this._baseOnClick(t,e),L(this.options.jsonConfig,e),S.trigger("swatches-click",[t,this.isSelectionEmulated]);const r=this.isSelectionEmulated&&j();r&&new LazyLoad({elements_selector:"img,div",data_srcset:"originalset"}),(!this.isSelectionEmulated||r)&&(this._updateAlternateSwatches(),this._updateDeliveryTermsMessage())},_baseOnClick:function(t,e){var i=t.parents("."+e.options.classes.attributeClass),a=t.parents("."+e.options.classes.attributeOptionsWrapper),s=i.find("."+e.options.classes.attributeSelectedOptionLabelClass),r=i.data("attribute-id"),c=i.find("."+e.options.classes.attributeInput),n=JSON.parse(this.options.jsonSwatchConfig[r].additional_data),u=e.element.parents(e.options.selectorProduct).find(this.options.selectorProductPrice);e.inProductList&&(c=e.productForm.find("."+e.options.classes.attributeInput+'[name="super_attribute['+r+']"]')),!t.hasClass("disabled")&&(t.hasClass("selected")?(i.removeAttr("data-option-selected").find(".selected").removeClass("selected"),c.val(""),s.text(""),t.attr("aria-checked",!1)):(i.attr("data-option-selected",t.data("option-id")).find(".selected").removeClass("selected"),s.text(t.data("option-label")),c.val(t.data("option-id")),c.attr("data-attr-name",this._getAttributeCodeById(r)),t.addClass("selected"),e._toggleCheckedAttributes(t,a)),this.isSelectionEmulated||(e._Rebuild(),u.is(":data(mage-priceBox)")&&e._UpdatePrice(),o(document).trigger("updateMsrpPriceBlock",[this._getSelectedOptionPriceIndex(),e.options.jsonConfig.optionPrices,u]),parseInt(n.update_product_preview_image,10)===1&&e._loadMedia()),c.trigger("change"))},_UpdatePrice:function(){(!this.isSelectionEmulated||this.isSelectionEmulated&&j())&&this._super()},updateBaseImage:function(t,e,i){!v&&S.width()<=C||(!this.isSelectionEmulated||j())&&this._super(t,e,i)},_onGalleryLoaded:function(t){(v||S.width()>C)&&this._super(t)},_getSelectedAttributes:function(){var t=this.options.jsonConfig.mappedAttributes,e=window.location.href.indexOf("#"),i=e!==-1?o.parseQuery(window.location.href.substr(e+1)):null,a=i?m.invert(this.options.jsonConfig.sku)[i.sku]:null,s=a?T(t,a):[];return M(t,s)?s:A(t)},_EmulateSelected:function(t){this.isSelectionEmulated=!0;const e=Object.keys(t).length;let i=0;o.each(t,o.proxy(function(a,s){i++,i===e&&(this.isSelectionEmulated=!1);var r=this.element.find("."+this.options.classes.attributeClass+'[data-attribute-code="'+a+'"] [data-option-id="'+s+'"]'),c=r.parent();r.hasClass("selected")||(c.hasClass(this.options.classes.selectClass)?(c.val(s),c.trigger("change")):r.trigger("click"))},this))},_RenderControls:function(){var t=this,e=this.element,i=this.options.classes,a=this.options.jsonConfig.chooseText,s=this.options.isShowControlType,r=this.options.showTooltip;t.optionsMap={};var c=this.options.jsonConfig;o.each(this.options.jsonConfig.attributes,function(){var n=this,u="option-label-"+n.code+"-"+n.id,w=t._RenderSwatchOptions(n,u),h=t._RenderSwatchSelect(n,a),_=t._RenderFormInput(n),g="",l="";if(t.options.onlySwatches&&!t.options.jsonSwatchConfig.hasOwnProperty(n.id))return;t.options.enableControlLabel&&(l+='<div class="swatch-attribute-header"><span id="'+u+'" class="'+i.attributeLabelClass+'">'+o("<i></i>").text(n.label).html()+':</span><span class="'+i.attributeSelectedOptionLabelClass+'"></span><span class="product-option-info-icon" data-option-modal="product_option_modal_'+n.code+'"><span class="fas fa-info-circle"></span></span></div>'),t.inProductList?(t.productForm.append(_),_="",g='aria-label="'+o("<i></i>").text(n.label).html()+'"'):g='aria-labelledby="'+u+'"';var p=c.swatchesAdditionalHtml,d=p?p.swatchAttribute:null,f=d?d[n.code]:null;const y=o("body").hasClass("checkout-cart-configure")?"":'style="display: none';e.append('<div class="'+i.attributeClass+" "+n.code+" "+n.code+"-visible-"+s+'" data-attribute-code="'+n.code+'" data-attribute-id="'+n.id+'" '+y+'" data-role="step">'+l+'<div aria-activedescendant="" tabindex="0" aria-invalid="false" aria-required="true" role="listbox" '+g+'class="'+i.attributeOptionsWrapper+' clearfix">'+w+h+"</div>"+_+(f||"")+"</div>"),t.optionsMap[n.id]={},o.each(n.options,function(){this.products.length>0&&(t.optionsMap[n.id][this.id]={price:parseInt(t.options.jsonConfig.optionPrices[this.products[0]].finalPrice.amount,10),products:this.products})})}),r===1&&e.find('[data-option-type="1"], [data-option-type="2"], [data-option-type="0"], [data-option-type="3"]').SwatchRendererTooltip(),o("."+i.moreButton).nextAll().hide(),t._EventListener(),t._Rewind(e),t._EmulateSelected(o.parseQuery()),t._EmulateSelected(t._getSelectedAttributes())},_RenderSwatchOptions:function(t,e){var i=this.options.jsonSwatchConfig[t.id],a=this.options.classes.optionClass,s=this.options.jsonSwatchImageSizeConfig,r=parseInt(this.options.numberToShow,10),c=this.options.classes.moreButton,n=this.options.moreButtonText,u=this.options.isShowControlType,w=0,h="";if(!this.options.jsonSwatchConfig.hasOwnProperty(t.id))return"";var _=this;return o.each(t.options,function(g){var l,p,d,f,y,k,x,b,O,E;if(!i.hasOwnProperty(this.id))return"";r===w++&&(h+='<a href="#" class="'+c+'"><span>'+n+"</span></a>"),l=this.id,p=parseInt(i[l].type,10),d=i[l].hasOwnProperty("value")?o("<i></i>").text(i[l].value).html():"",f=i[l].hasOwnProperty("thumb")?i[l].thumb:"",k=m.has(s,"swatchThumb")?s.swatchThumb.width:110,x=m.has(s,"swatchThumb")?s.swatchThumb.height:90,y=this.label?o("<i></i>").text(this.label).html():"",b=' id="'+e+"-item-"+l+'" index="'+g+'" aria-checked="false" aria-describedby="'+e+'" tabindex="0" data-option-type="'+p+'" data-option-id="'+l+'" data-option-label="'+y+'" aria-label="'+y+'" role="option" data-thumb-width="'+k+'" data-thumb-height="'+x+'"',b+=f!==""?' data-option-tooltip-thumb="'+f+'"':"",b+=d!==""?' data-option-tooltip-value="'+d+'"':"";var I=i[l].hasOwnProperty("size_code")?i[l].size_code:!1,P=I?"swatchImageLarge":"swatchImage";O=m.has(s,P)?s[P].width:30,E=m.has(s,P)?s[P].height:20,(!this.hasOwnProperty("products")||this.products.length<=0)&&(b+=' data-option-empty="true"'),p===0?h+='<div class="'+a+' text" '+b+">"+(d||y)+"</div>":p===1?h+='<div class="'+a+' color" '+b+' style="background: '+d+' no-repeat center; background-size: initial;"></div>':p===2?h+='<div class="'+a+' image" '+b+' style="height: initial"><div style="width:'+O+"px; height:"+E+'px"><img src="'+_.options.lazyLoadPixelUrl+'" data-original="'+d+'" width="'+O+'" height="'+E+'" /></div>'+(I?'<div class="swatch-option-label">'+y+"</div>":"")+"</div>":p===3?h+='<div class="'+a+'" '+b+"></div>":h+='<div class="'+a+'" '+b+">"+y+"</div>"}),h},_updateDeliveryTermsMessage:function(){let t=".product-addtocart-top-block .delivery-message, .product-info-messages .delivery-message",e=o(t),i=this.options.jsonConfig.additionalAttributes,a=i[this.getProduct()].delivery_terms?i[this.getProduct()].delivery_terms:"&nbsp;";e.length&&o(e).html(a)},_updateAlternateSwatches:function(){var t=o(".swatch-attribute.system_type").find(".swatch-option.selected").data("option-id");if(!t){this._returnOriginalSwatches();return}this._updateAlternateSystemTypes(),this._updateOtherAlternateSwatches(t)},_updateAlternateSystemTypes:function(){m.each(this.options.jsonConfig.alternateSwatches.mapping,function(t,e){var i=t[e],a=this.options.jsonConfig.alternateSwatches.options.hasOwnProperty(i)?this.options.jsonConfig.alternateSwatches.options[i]:null;!a||this._replaceSwatchImage(e,a)},this)},_updateOtherAlternateSwatches:function(t){var e=this.options.jsonConfig.alternateSwatches.mapping.hasOwnProperty(t)?this.options.jsonConfig.alternateSwatches.mapping[t]:null;if(!e){this._returnOriginalSwatches();return}m.each(e,function(i,a){var s=this.options.jsonConfig.alternateSwatches.options.hasOwnProperty(i)?this.options.jsonConfig.alternateSwatches.options[i]:null;!s||this._replaceSwatchImage(a,s)},this)},_returnOriginalSwatches:function(){var t=m.map(this.options.jsonConfig.alternateSwatches.mapping,function(e){return m.keys(e)});t=[].concat.apply([],t),m.each(t,function(e){var i=null;m.each(this.options.jsonSwatchConfig,function(a,s){var r=a.hasOwnProperty(e)?a[e]:null;r&&(i=r)}),i&&this._replaceSwatchImage(e,i)},this)},_replaceSwatchImage:function(t,e){var i,a;if(!this.optionElements){this.optionElements={};const c=o("[data-option-id]"),n=this;c.each(function(){var u;const w=this;n.optionElements[w.dataset.optionId]={optionElement:w,imageElement:(u=w==null?void 0:w.firstElementChild)==null?void 0:u.firstElementChild}})}const s=(i=this.optionElements[t])==null?void 0:i.optionElement,r=(a=this.optionElements[t])==null?void 0:a.imageElement;s&&(s.dataset.tooltipThumb=e.thumb,s.dataset.tooltipValue=e.thumb),r&&(r.src=e.value,r.dataset.original=e.value)}},z={options:{delay:200,tooltipClass:"swatch-option-tooltip"},_init:function(){var t=this,e=this.element,i=o("."+t.options.tooltipClass),a,s=parseInt(e.data("option-type"),10),r=e.data("option-label"),c=e.data("option-tooltip-thumb"),n=e.data("option-tooltip-value"),u=e.data("thumb-width"),w=e.data("thumb-height"),h,_,g;i.length||(i=o('<div class="'+t.options.tooltipClass+'"><div class="image"></div><div class="title"></div><div class="corner"></div></div>'),o("body").append(i)),h=i.find(".image"),_=i.find(".title"),g=i.find(".corner"),e.hover(function(){e.hasClass("disabled")||(a=setTimeout(function(){var l=null,p=0,d,f;s===2?(h.css({background:'url("'+e.data("option-tooltip-thumb")+'") no-repeat center',"background-size":"initial",width:u+"px",height:w+"px"}),h.show()):s===1?(h.css({background:e.data("option-tooltip-value")}),h.show()):(s===0||s===3)&&h.hide(),_.text(r),l=e.offset().left,d=l+e.width()/2-i.width()/2,f=o(window),d<0?d=5:d+i.width()>f.width()&&(d=f.width()-i.width()-5),p=0,i.width()<e.width()?p=i.width()/2-3:p=(l>d?l-d:d-l)+e.width()/2-6,g.css({left:p}),i.css({left:d,top:e.offset().top-i.height()-g.height()-18}).show()},t.options.delay))},function(){i.hide(),clearTimeout(a)}),o(document).on("tap",function(){i.hide(),clearTimeout(a)}),e.on("tap",function(l){l.stopPropagation()})}};return function(t){return o.widget("mage.SwatchRenderer",t,R),o.widget("mage.SwatchRendererTooltip",z),o.mage.SwatchRenderer}});
