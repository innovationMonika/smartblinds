define(["jquery"],function(s){return{candidates:{},addCandidate:function(t,e){this.candidates[e]=t},removeCandidate:function(t){typeof this.candidates[t]!="undefined"&&delete this.candidates[t]},getCandidates:function(){return this.candidates},getLastCandidate:function(){var t,e=0;for(var r in this.candidates)!this.candidates.hasOwnProperty(r)||(e<r&&(t=this.candidates[r]),e=r);return t},replace:function(){var t=this.getLastCandidate(),e=this,r,a;!t||typeof t=="undefined"||s.when(e.waitLoadGallery()).then(function(i){a=i.returnCurrentImages(),e.fillImageWithDefaultData(t),a.forEach(function(n,o){if(typeof n.is_custom!="undefined"&&n.is_custom==1){a.splice(o,1);return}n.isMain==!0&&(n.isMain=!1,n.position+=1)}),a.unshift(t),i.updateData(a),i.first()},function(i){console.log(i)})},forceRefresh:function(){var t=this.getLastCandidate(),e=this,r,a;s.when(e.waitLoadGallery()).then(function(i){a=i.returnCurrentImages(),a.forEach(function(n,o){if(typeof n.is_custom!="undefined"&&n.is_custom==1){a.splice(o,1);return}t&&n.isMain==!0&&(n.isMain=!1,n.position+=1)}),t&&(e.fillImageWithDefaultData(t),a.unshift(t)),i.updateData(a)},function(i){console.log(i)})},fillImageWithDefaultData:function(t){return t.caption=t.label,t.i=1,t.isMain=!0,t.position=1,t.is_custom=1,t},waitLoadGallery:function(){var t=s.Deferred(),e=setInterval(function(){gallery=s("[data-gallery-role=gallery-placeholder]").data("gallery"),typeof gallery!="undefined"&&(clearInterval(e),t.resolve(gallery))},500);return t.promise()}}});
