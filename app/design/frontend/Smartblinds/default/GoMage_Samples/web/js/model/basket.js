define(["jquery","underscore","Magento_Customer/js/customer-data","Magento_Ui/js/view/messages","mage/translate","domReady!"],function(m,a,u){"use strict";var n=20,i="samples-items-1";function o(e){var t=new CustomEvent("sample-basket-updated",{detail:{items:e}});window.dispatchEvent(t)}function f(e,t){var s=new CustomEvent("sample-item-"+e,{detail:{item:t}});window.dispatchEvent(s)}return{addItem:function(e,t){if(this.getSimpleItems().length>=n)throw"You have reached maximum samples limit of "+n+" pieces.";if(!(t&&t.id!==e.parentId)&&!this.getItemBySwatches(e)){var s=[e];t&&!this.getItemById(t.id)&&s.push(t);var r=a.union(this.getItems(),s);localStorage.setItem(i,JSON.stringify(r)),o(r),f("add",e),this._doViewStuff(e)}},removeItem:function(e){var t=this.getItemById(e);if(t){var s=a.filter(this.getItems(),function(c){return c.id!==e}),r=t.parentId;if(r){var d=a.where(s,{parentId:r});d.length||(s=a.filter(s,function(c){return c.id!==r}))}localStorage.setItem(i,JSON.stringify(s)),o(s),f("remove",t)}},getItems:function(){try{var e=JSON.parse(localStorage.getItem(i));return Array.isArray(e)?a.first(e,n):[]}catch{return[]}},getSimpleItems:function(){try{var e=JSON.parse(localStorage.getItem(i)),t=a.filter(e,function(s){return s.type==="simple"});return Array.isArray(e)?a.first(t,n):[]}catch{return[]}},getItemById:function(e){return a.findWhere(this.getItems(),{id:e})},getItemBySwatches:function(e){return a.first(this._getItemsBySwatches(e))},removeItemBySwatches:function(e){a.each(this._getItemsBySwatches(e),function(t){this.removeItem(t.id)},this)},getMaxQty:function(){return n},clear:function(){var e=[];localStorage.setItem(i,JSON.stringify(e)),o(e)},_getItemsBySwatches:function(e){var t=a.keys(e.swatches),s=e.systemCategory;return a.filter(this.getSimpleItems(),function(r){if(e.id==r.id)return!0;return!1;var d})},_doViewStuff:function(e){var t=m.mage.__("You have add %1 in samples").replace("%1",e.name);u.set("messages",{messages:[{type:"success samples-add",text:t}]}),m(".sample-basket-toggle").on("click",function(s){s.preventDefault(),m(".header .sample-basket-link").click()}),setTimeout(function(){m(".messages .message").addClass("active")},100),setTimeout(function(){u.set("messages",{})},5e3)}}});
