define(["jquery","underscore","Magento_Customer/js/customer-data","Magento_Ui/js/view/messages","mage/translate"],function(u,r,f){"use strict";var i=20,o="samples-items-1";function m(e){var t=new CustomEvent("sample-basket-updated",{detail:{items:e}});window.dispatchEvent(t)}function g(e,t){var s=new CustomEvent("sample-item-"+e,{detail:{item:t}});window.dispatchEvent(s)}return{addItem:function(e,t){if(this.getSimpleItems().length>=i)throw"You have reached maximum samples limit of "+i+" pieces.";if(!(t&&t.id!==e.parentId)&&!this.getItemBySwatches(e)){var s=[e];t&&!this.getItemById(t.id)&&s.push(t);var a=r.union(this.getItems(),s);localStorage.setItem(o,JSON.stringify(a)),m(a),g("add",e),this._doViewStuff(e)}},removeItem:function(e){var t=this.getItemById(e);if(!!t){var s=r.filter(this.getItems(),function(n){return n.id!==e}),a=t.parentId;if(a){var c=r.where(s,{parentId:a});c.length||(s=r.filter(s,function(n){return n.id!==a}))}localStorage.setItem(o,JSON.stringify(s)),m(s),g("remove",t)}},getItems:function(){try{var e=JSON.parse(localStorage.getItem(o));return Array.isArray(e)?r.first(e,i):[]}catch{return[]}},getSimpleItems:function(){try{var e=JSON.parse(localStorage.getItem(o)),t=r.filter(e,function(s){return s.type==="simple"});return Array.isArray(e)?r.first(t,i):[]}catch{return[]}},getItemById:function(e){return r.findWhere(this.getItems(),{id:e})},getItemBySwatches:function(e){return r.first(this._getItemsBySwatches(e))},removeItemBySwatches:function(e){r.each(this._getItemsBySwatches(e),function(t){this.removeItem(t.id)},this)},getMaxQty:function(){return i},clear:function(){var e=[];localStorage.setItem(o,JSON.stringify(e)),m(e)},_getItemsBySwatches:function(e){var t=r.keys(e.swatches),s=e.systemCategory;return r.filter(this.getSimpleItems(),function(a){if(e.id==a.id)return!0;return!1;var c})},_doViewStuff:function(e){var t=u.mage.__("You have add %1 in samples").replace("%1",e.name);f.set("messages",{messages:[{type:"success samples-add",text:t}]}),u(".sample-basket-toggle").on("click",function(s){s.preventDefault(),u(".header .sample-basket-link").click()}),setTimeout(function(){u(".messages .message").addClass("active")},100),setTimeout(function(){f.set("messages",{})},5e3)}}});
