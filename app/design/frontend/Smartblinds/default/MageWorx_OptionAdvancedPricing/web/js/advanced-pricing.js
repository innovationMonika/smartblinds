define(["jquery","Magento_Catalog/js/price-utils","priceBox","jquery-ui-modules/widget"],function(i,h){"use strict";return i.widget("mageworx.optionAdvancedPricing",{options:{optionConfig:{}},firstRun:function(e,r,o,c){o.setOptionValueTitle(),this.priceBox=i(".price-box",t),this.optionConfigSaved=h.deepClone(e),this.productConfig=r;var t=o.getFormElement(),a=o.options,s=i(a.optionsSelector,t);s.filter("input").each(function(n,f){var u=i(f),d=h.findOptionId(u),l=u.val();e[d].type==="char"&&c.updatePricePerCharacter(d,e,l)})},updatePricePerCharacter:function(e,r,o){if(r[e].prices.basePrice.amount=o.length*this.optionConfigSaved[e].prices.basePrice.amount,r[e].prices.finalPrice.amount=o.length*this.optionConfigSaved[e].prices.finalPrice.amount,i("#price_per_character_"+e).html(r[e].prices.finalPrice.amount.toFixed(2)),this.productConfig.type_id==="configurable"){var c={};c["options["+e+"]"]={basePrice:{amount:parseFloat(r[e].prices.basePrice.amount.toFixed(2))},finalPrice:{amount:parseFloat(r[e].prices.finalPrice.amount.toFixed(2))}},this.priceBox.trigger("updatePrice",c)}},update:function(e,r,o,c){var t=i(e),a=t.val(),s=this;i("option",t).each(function(d,l){var p=i("#value_"+l.value+"_tier_price");p.length>0&&p.hide()});var n=c.getOptionId(t);if(isNaN(n)){var f=t.attr("name"),u=f.match(/(\d+)/);u&&(n=parseInt(u[0]))}if(i.inArray(s.options.optionTypes[n],["drop_down","multiple","checkbox","radio","area","field"])!==-1)if(i.inArray(s.options.optionTypes[n],["area","field"])!==-1)r[n].type==="char"&&s.updatePricePerCharacter(n,r,a);else if(a)Array.isArray(a)||(a=[a]),i(a).each(function(d,l){var p=i("#value_"+l+"_tier_price");p.length>0&&(t.is(":checked")||i("option:selected",t).val()?p.show():p.hide())});else return}}),i.mageworx.optionAdvancedPricing});
