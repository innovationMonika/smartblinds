define(["jquery","ko"],function(n,d){"use strict";var i=d.observableArray();return{steps:i,stepCodes:[],validCodes:[],handleHash:function(){var e=window.location.hash.replace("#",""),t;return e===""?!1:n.inArray(e,this.validCodes)===-1?(window.location.href=window.checkoutConfig.pageNotFoundUrl,!1):(t=i.sort(this.sortItems).some(function(s){return(s.code==e||s.alias==e)&&s.isVisible()}),t||i().sort(this.sortItems).forEach(function(s){s.code==e||s.alias==e?s.navigate(s):s.isVisible(!1)}),!1)},registerStep:function(e,t,s,o,r,a){var l,c;if(n.inArray(e,this.validCodes)!==-1)throw new DOMException("Step code ["+e+"] already registered in step navigator");if(t!=null){if(n.inArray(t,this.validCodes)!==-1)throw new DOMException("Step code ["+t+"] already registered in step navigator");this.validCodes.push(t)}this.validCodes.push(e),i.push({code:e,alias:t??e,title:s,isVisible:o,navigate:r,sortOrder:a}),c=this.getActiveItemIndex(),i.each(function(h,u){c!==u&&h.isVisible(!1)}),this.stepCodes.push(e),l=window.location.hash.replace("#",""),l!=""&&l!=e&&o(!1)},sortItems:function(e,t){return e.sortOrder>t.sortOrder?1:-1},getActiveItemIndex:function(){var e=0;return i().sort(this.sortItems).some(function(t,s){return t.isVisible()?(e=s,!0):!1}),e==1?n("body").addClass("third-step"):n("body").removeClass("third-step"),e},isProcessed:function(e){var t=this.getActiveItemIndex(),s=i().sort(this.sortItems),o=-1;return s.forEach(function(r,a){r.code==e&&(o=a)}),t>o},navigateTo:function(e,t){var s=i().sort(this.sortItems),o=n("body");t=t||null,!!this.isProcessed(e)&&s.forEach(function(r){r.code==e?(r.isVisible(!0),o.animate({scrollTop:n("#"+e).offset().top},0,function(){window.location=window.checkoutConfig.checkoutUrl+"#"+e}),t&&n("#"+t).length&&o.animate({scrollTop:n("#"+t).offset().top},0)):r.isVisible(!1)})},setHash:function(e){window.location.hash=e},next:function(){var e=0,t;i().sort(this.sortItems).forEach(function(s,o){s.isVisible()&&(s.isVisible(!1),e=o)}),i().length>e+1&&(t=i()[e+1].code,i()[e+1].isVisible(!0),this.setHash(t),document.body.scrollTop=document.documentElement.scrollTop=0)}}});
