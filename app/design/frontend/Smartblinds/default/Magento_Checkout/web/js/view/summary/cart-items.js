define(["ko","Magento_Checkout/js/model/totals","uiComponent","Magento_Checkout/js/model/step-navigator","Magento_Checkout/js/model/quote","underscore","mage/translate"],function(m,e,l,C,a,n,p){"use strict";var h=window.checkoutConfig.useQty;function f(t){try{JSON.parse(t)}catch{return!1}return!0}return l.extend({defaults:{template:"Magento_Checkout/summary/cart-items"},totals:e.totals(),items:m.observable([]),maxCartItemsToDisplay:window.checkoutConfig.maxCartItemsToDisplay,cartUrl:window.checkoutConfig.cartUrl,isVisible:function(){return!a.isVirtual()},getItems:e.getItems(),getItemsQty:function(){return parseFloat(this.totals.items_qty)},getCartLineItemsCount:function(){return parseInt(e.getItems()().length,10)},getCartSummaryItemsCount:function(){return h?this.getItemsQty():this.getCartLineItemsCount()},initialize:function(){this._super(),this.setItems(e.getItems()()),e.getItems().subscribe(function(t){this.setItems(t)}.bind(this))},setItems:function(t){t&&t.length>0&&(t=t.slice(parseInt(-this.maxCartItemsToDisplay,10))),this.items(this.prepareProductOptions(t))},prepareProductOptions:function(t){return n.each(t,function(i){var o=JSON.parse(i.options);n.each(o,function(s,r){if(s){if(window.quoteItemCanOptionRemove&&window.quoteItemCanOptionRemove.label==s.label&&window.quoteItemCanOptionRemove.value==s.value)o.splice(r,1);else if(f(s.value.replace(/(&quot;)/gm,'"'))){var u=JSON.parse(s.value.replace(/(&quot;)/gm,'"')),c=[];n.isObject(u)&&(n.each(u,function(g,I){c.push(p(I)+": "+parseFloat(g/10))}),o[r].value=c.join(", "))}}}),i.options=JSON.stringify(o)},this),t},isItemsBlockExpanded:function(){return a.isVirtual()}})});
