define(["underscore","Magento_Checkout/js/model/resource-url-manager","Magento_Checkout/js/model/quote","mage/storage","Magento_Checkout/js/model/totals","Magento_Checkout/js/model/error-processor","Magento_Checkout/js/model/cart/cache","Magento_Customer/js/customer-data"],function(l,c,e,g,h,u,a,m){"use strict";var C=function(s){var i,d;return h.isLoading(!0),i=c.getUrlForTotalsEstimationForNewAddress(e),d={addressInformation:{address:l.pick(s,a.requiredFields)}},e.shippingMethod()&&e.shippingMethod().method_code&&(d.addressInformation.shipping_method_code=e.shippingMethod().method_code,d.addressInformation.shipping_carrier_code=e.shippingMethod().carrier_code),g.post(i,JSON.stringify(d),!1).done(function(o){var p={totals:o,address:s,cartVersion:m.get("cart")().data_id,shippingMethodCode:null,shippingCarrierCode:null};if(e.shippingMethod()&&e.shippingMethod().method_code&&(p.shippingMethodCode=e.shippingMethod().method_code,p.shippingCarrierCode=e.shippingMethod().carrier_code),window.quoteItemCanOptionRemove&&window.quoteItemCanOptionRemove.value&&window.quoteItemCanOptionRemove.label){let M=o.items.length,n=0;for(n=0;n<M;n++){let r=JSON.parse(o.items[n].options),f=r.length,t=0;for(t=0;t<f;t++)if(r[t].value===window.quoteItemCanOptionRemove.value&&r[t].label===window.quoteItemCanOptionRemove.label){r.splice(t,1),o.items[n].options=JSON.stringify(r);break}}}e.setTotals(o),a.set("cart-data",p)}).fail(function(o){u.process(o)}).always(function(){h.isLoading(!1)})};return{requiredFields:a.requiredFields,estimateTotals:function(s){var i={shippingMethodCode:null,shippingCarrierCode:null};return e.shippingMethod()&&e.shippingMethod().method_code&&(i.shippingMethodCode=e.shippingMethod().method_code,i.shippingCarrierCode=e.shippingMethod().carrier_code),C(s)}}});
