define(["jquery","underscore","mage/translate","Magento_Catalog/js/price-utils","jquery/validate","jquery-ui-modules/widget","jquery/jquery.parsequery"],function(e,f,h,c){"use strict";return e.widget("mageworx.optionSwatches",{options:{hiddenSelectClass:"mageworx-swatch",optionClass:"mageworx-swatch-option"},firstRun:function(a,t,s,n){this._observeStyleOptions(),this._grayoutDisabledOptions(),this._initEventListener(),this._validateRequiredSwatches()},_observeStyleOptions:function(){var a=this,t=e("."+this.options.optionClass).parent().next("select").find("option");e.each(t,function(){a.processSwatchLabel(e(this))});var s=new MutationObserver(function(n){n.forEach(function(l){a._toggleSwatch(e(l.target))})});e.each(t,function(n,l){s.observe(l,{attributes:!0,attributeFilter:["style"]})})},_grayoutDisabledOptions:function(){e("."+this.options.optionClass).each(function(){var a=e(this),t=a.attr("data-option-id"),s=a.attr("data-option-type-id"),n=e("#select_"+t+' option[value="'+s+'"]');n.prop("disabled")&&a.addClass("disabled")})},_toggleSwatch:function(a){var t=e('[data-option-type-id="'+a.val()+'"]');this.processSwatchLabel(a,t),a.css("display")=="block"||a.css("display")=="inline"?t.parent().css("display","inline-block"):a.css("display")=="none"&&(t.parent().css("display","none"),t.removeClass("selected"))},processSwatchLabel:function(a){var t=a.parents("select"),s=c.findOptionId(t),n=e("#select_"+s+" option");if(n){var l=t.parents(".field").find("label");l.parent().find("span#value").length<=0&&l.after('<span id="value"></span>');var i=[],r=!1,d=-1;t.val()&&e(n).each(function(){if(Array.isArray(t.val())&&(d=e.inArray(e(this).attr("value"),t.val())),d!==-1||t.val()===e(this).attr("value")){r=!0;var o=e("[data-option-type-id='"+e(this).attr("value")+"']");o.addClass("selected"),o.attr("data-option-price")>0?i.push(e(this).text()):i.push(o.attr("data-option-label"))}});var p=l.parent().find("span#value");r===!1?p.html(""):p.html(" - "+i.join(", "))}},update:function(a,t,s,n){if(e(a).hasClass(this.options.hiddenSelectClass)){e(a).val()==""&&(e(a).parent().parent().find(".selected").removeClass("selected"),e(a).parents(".field").find("label").parent().find("span#value").html(""));var l=c.findOptionId(a),i=e("#select_"+l+" option").first();this.processSwatchLabel(i)}},_initEventListener:function(){var a=this;e("body").on("click","."+this.options.optionClass,function(t,s,n){a._onClick(this)})},_onClick:function(a){if(!e(a).hasClass("disabled")){var t=this,s=e(a).attr("data-option-id"),n=e(a).attr("data-option-type-id"),l=e(a).attr("data-option-type"),i=e("#select_"+s),r=e("#select_"+s+" option");!r||(e(a).parents(".field").find("label").parent().find("span#value").length<=0&&e(a).parents(".field").find("label").after('<span id="value"></span>'),e(r).each(function(){if(l==="multiple"){if(e(this).val()==n){if(e(a).hasClass("selected")){if(f.contains(e(i).val(),e(this).attr("value"))){var d=e(i).val().filter(function(u,v,b){return u!=n});d.length<1?e(i).val(""):e(i).val(d)}e(a).removeClass("selected")}else{if(!e(i).val())e(i).val(n);else{var p=e(i).val();p.push(n),e(i).val(p)}e(a).addClass("selected")}e(i).trigger("change");return}}else if(e(this).val()==n){if(e(a).hasClass("selected"))e(i).val(""),e(a).parents(".field").find("label").parent().find("span#value").html(""),e(a).parent().parent().find(".selected").removeClass("selected");else{e(i).val(n);var o=e(a).parents(".field").find("label").parent().find("span#value");o.html(" - "+e(a).attr("data-option-label")),e(a).attr("data-option-price")>0&&o.html(o.html()+" +"+c.formatPrice(e(a).attr("data-option-price"))),e(a).parent().parent().find(".selected").removeClass("selected"),e(a).addClass("selected")}e(i).trigger("change");return}}))}},_validateRequiredSwatches:function(){var a=this;e("#product_addtocart_form").mage("validation",{ignore:":hidden:not(."+a.options.hiddenSelectClass+")",radioCheckboxClosest:".nested",submitHandler:function(t){var s=e(t).catalogAddToCart({bindSubmit:!1});return s.catalogAddToCart("submitForm",e(t)),!1}})}}),e.mageworx.optionSwatches});
