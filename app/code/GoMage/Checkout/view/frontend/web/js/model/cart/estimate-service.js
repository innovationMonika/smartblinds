define(["Magento_Checkout/js/model/quote","Magento_Checkout/js/model/shipping-rate-processor/new-address","Magento_Checkout/js/model/cart/totals-processor/default","Magento_Checkout/js/model/shipping-service","Magento_Checkout/js/model/cart/cache","Magento_Customer/js/customer-data"],function(e,n,d,r,i,o){"use strict";var a={},s={},g=function(){var t=e.shippingAddress().getType();if(e.isVirtual()||window.checkoutConfig.activeCarriers&&window.checkoutConfig.activeCarriers.length===0)s.default=d,s[t]?s[t].estimateTotals(e.shippingAddress()):s.default.estimateTotals(e.shippingAddress());else{if(!i.isChanged("address",e.shippingAddress())&&!i.isChanged("cartVersion",o.get("cart")().data_id)&&i.get("rates")){r.setShippingRates(i.get("rates"));return}a.default=n,a[t]?a[t].getRates(e.shippingAddress()):a.default.getRates(e.shippingAddress()),r.getShippingRates().subscribe(function(u){i.set("rates",u)})}},l=function(){d.estimateTotals(e.shippingAddress())},c=function(){var t=null;e.billingAddress()&&(t=e.billingAddress().getType()),e.isVirtual()&&(s.default=d,t&&s[t]?s[t].estimateTotals(e.billingAddress()):s.default.estimateTotals(e.billingAddress()))};e.shippingAddress.subscribe(g),e.shippingMethod.subscribe(l),e.billingAddress.subscribe(c)});
