define(["jquery","ko","underscore","Magento_Ui/js/form/form","Magento_Checkout/js/model/quote","MageWorx_MultiFees/js/model/shipping-fee","MageWorx_MultiFees/js/action/apply-fees","MageWorx_MultiFees/js/model/fee-messages","mage/translate","mage/url","mageUtils","uiRegistry","MageWorx_MultiFees/js/form/element/select","MageWorx_MultiFees/js/form/element/date","MageWorx_MultiFees/js/form/element/checkbox-set","MageWorx_MultiFees/js/form/element/textarea","MageWorx_MultiFees/js/form/element/hidden"],function(s,h,o,g,c,F,p,m,x,M,_,y){"use strict";var v=x("You need to select required additional fees to proceed to checkout"),f=h.observable(!1);function b(i){var r="?";return o.each(i,function(t,e){r+=e+"="+t+"&"}),r.slice(0,-1)}return g.extend({defaults:{reloadUrl:M.build("multifees/checkout/refreshShipping")},initialize:function(){var i=this;this._super();var r=this.elems().length>0;return this.shouldShow(r),c.shippingMethod.subscribe(function(t){if(t&&t.carrier_code&&t.method_code){var e=t.carrier_code+"_"+t.method_code;i.updateContent(e)}},null,"change"),this},isLoading:f,onSubmit:function(){if(this.source.set("params.invalid",!1),this.source.trigger("mageworxShippingFeeForm.data.validate"),this.source.get("params.invalid"))m.addErrorMessage({message:v});else{f(!0);var i=this.source.get("mageworxShippingFeeForm");i.type=3,p(i,f,"mageworx-shipping-fee-form")}},isDisplayTitle:function(){return!1},shouldShow:h.observable(!1),updateContent:function(i){var r=this.reloadData(i),t=this;return r.done(function(e){y.async("index = mageworx-shipping-fee-form-fieldset")(function(d){d.elems&&d.destroyChildren();var u=o.isEmpty(e)?[]:e.filter(function(n){return n.isVisibleInputType}),a=!o.isEmpty(u);this.shouldShow(a),this.childCandidates=e,o.forEach(e,function(n,l){n.index=l,e[l]=require(n.component)(o.extend(n,n.config))}),d.insertChild(e)}.bind(t))}),this},reloadData:function(i){var r=this.params,t={shipping_method:i},e=this.getData()?o.extend(this.getData(),t):t,d=this.reloadUrl,u=s.Deferred();return e.form_key=window.FORM_KEY,e=_.serialize(e),d||u.resolve(),s("body").trigger("processStart"),s.ajax({url:d+b(r),data:e,type:"post",dataType:"json",success:function(a){if(a.ajaxExpired&&(window.location.href=a.ajaxRedirect),!a.error)return u.resolve(a),!0;s("body").notification("clear"),s.each(a.messages,function(n,l){s("body").notification("add",{error:a.error,message:l,insertMethod:function(j){s(".page-main-actions").after(j)}})})},complete:function(){s("body").trigger("processStop")}}),u.promise()},getData:function(){var i=c.shippingAddress()?o.pick(c.shippingAddress(),function(r,t,e){return!o.isFunction(r)}):{};return{shippingAddressData:i}}})});
