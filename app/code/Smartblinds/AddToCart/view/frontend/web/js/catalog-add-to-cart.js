define(["jquery","mage/translate","underscore","Magento_Catalog/js/product/view/product-ids-resolver","Magento_Catalog/js/product/view/product-info-resolver","mage/template","jquery-ui-modules/widget"],function(t,d,u,p,m,f){"use strict";return t.widget("mage.catalogAddToCart",{options:{processStart:null,processStop:null,bindSubmit:!0,minicartSelector:'[data-block="minicart"]',messagesSelector:'[data-placeholder="messages"]',productStatusSelector:".stock.available",addToCartButtonSelector:".action.tocart",addToCartButtonDisabledClass:"disabled",addToCartButtonTextWhileAdding:"",addToCartButtonTextAdded:"",addToCartButtonTextDefault:"",productInfoResolver:m},_create:function(){this.options.bindSubmit&&this._bindSubmit(),t(this.options.addToCartButtonSelector).attr("disabled",!1)},_bindSubmit:function(){var a=this;this.element.data("catalog-addtocart-initialized")||(this.element.data("catalog-addtocart-initialized",1),this.element.on("submit",function(o){o.preventDefault(),a.submitForm(t(this))}))},_redirect:function(a){var o,r,i;o=a.split("#"),r=window.location.href.split("#"),i=o[0]===r[0],window.location.assign(a),i&&window.location.reload()},isLoaderEnabled:function(){return this.options.processStart&&this.options.processStop},submitForm:function(a){this.ajaxSubmit(a)},ajaxSubmit:function(a){var o=this,r=p(a),i=o.options.productInfoResolver(a),n;t(o.options.minicartSelector).trigger("contentLoading"),o.disableAddToCartButton(a),n=new FormData(a[0]),t.ajax({url:a.attr("action"),data:n,type:"post",dataType:"json",cache:!1,contentType:!1,processData:!1,beforeSend:function(){o.isLoaderEnabled()&&t("body").trigger(o.options.processStart)},success:function(e){var c,l;if(t(document).trigger("ajax:addToCart",{sku:a.data().productSku,productIds:r,productInfo:i,form:a,response:e}),o.isLoaderEnabled()&&t("body").trigger(o.options.processStop),e.backUrl){c={form:a,redirectParameters:[]},t("body").trigger("catalogCategoryAddToCartRedirect",c),c.redirectParameters.length>0&&window.location.href.split(/[?#]/)[0]===e.backUrl&&(l=e.backUrl.split("#"),l.push(c.redirectParameters.join("&")),e.backUrl=l.join("#")),o._redirect(e.backUrl);return}e.messages&&t(o.options.messagesSelector).html(e.messages),e.minicart&&(t(o.options.minicartSelector).replaceWith(e.minicart),t(o.options.minicartSelector).trigger("contentUpdated")),e.product&&e.product.statusText&&t(o.options.productStatusSelector).removeClass("available").addClass("unavailable").find("span").html(e.product.statusText),o.enableAddToCartButton(a);var g=f("#smartblindsAddToCartWidget"),s=t(".fotorama-item .fotorama__nav__frame .fotorama__thumb img").eq(0).attr("src");u.isUndefined(s)&&(s=t(".product.media .product-media-swiper .swiper-slide img").eq(0).attr("src")),u.isUndefined(s)&&(s=t(".fotorama-item .fotorama__stage__frame .fotorama__img").eq(0).attr("src"));var b=g({data:{product_image:s,product_price:t("#product-price-"+r[0]+" .price").eq(0).text(),product_qty:t("form .box-tocart .fieldset .qty .control .qty").eq(0).val()}}),C=t('<div class="add-to-cart-modal-popup"/>').html(b).modal({modalClass:"add-to-cart-popup",buttons:[{text:d("Continue shopping"),class:"continue-shopping",click:function(){this.closeModal()}},{text:window.jsonATCCustomWidgetConfig.product_type=="configurable"?d("View your configured Smartblind(s)"):d("View your shopping cart"),class:"to-shopping-cart",click:function(){window.location=window.checkout.shoppingCartUrl}}]});C.modal("openModal")},error:function(e){t(document).trigger("ajax:addToCart:error",{sku:a.data().productSku,productIds:r,productInfo:i,form:a,response:e})},complete:function(e){e.state()==="rejected"&&(t("body").hasClass("checkout-cart-configure")?window.location=window.checkout.shoppingCartUrl:location.reload())}})},disableAddToCartButton:function(a){var o=this.options.addToCartButtonTextWhileAdding||d("Adding..."),r=t(a).find(this.options.addToCartButtonSelector);r.addClass(this.options.addToCartButtonDisabledClass),r.find("span").text(o),r.attr("title",o)},enableAddToCartButton:function(a){var o=this.options.addToCartButtonTextAdded||d("Added"),r=this,i=t(a).find(this.options.addToCartButtonSelector);i.find("span").text(o),i.attr("title",o),setTimeout(function(){var n=r.options.addToCartButtonTextDefault||d("Add to Cart");i.removeClass(r.options.addToCartButtonDisabledClass),i.find("span").text(n),i.attr("title",n)},1e3)}}),t.mage.catalogAddToCart});
