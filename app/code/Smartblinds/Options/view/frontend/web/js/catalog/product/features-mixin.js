define(["jquery","underscore","Magento_Catalog/js/price-utils","getSwatchSelectedProductId","priceUtils"],function(t,y,O,F,C){"use strict";var E={calculateSelectedOptionsPrice:function(){this._super();var i=this,p=this.base.getFormElement(),c=this.base.options,n=t(c.optionsSelector,p);n.filter('input[type="hidden"]').each(function(m,r){var a=t(r),o=O.findOptionId(a),d=c.optionConfig&&c.optionConfig[o],f=a.val();if(a.closest(".field").css("display")==="none"){a.val("");return}var s=t(c.productQtySelector).val(),T=a.closest("#product_addtocart_form"),u=a.data("role"),x=T.data("mage-priceOptions").options.optionHandlers[u],P={};if(x){var g={};g[o]=d,P=x(a,g)}var h=P.hasOwnProperty(a.data("role"))?P[a.data("role")]:null,e=h||d.prices,b=e.basePrice.amount,_=e.finalPrice.amount;i.optionFinalPrice+=parseFloat(_)*s,i.optionOldPriceInclTax+=parseFloat(e.oldPrice.amount_incl_tax)*s,i.optionBasePrice+=parseFloat(b)*s,i.optionOldPriceExclTax+=parseFloat(e.oldPrice.amount_excl_tax)*s,i.optionFinalPricePerItem+=parseFloat(_),i.optionOldPricePerItemInclTax+=parseFloat(e.oldPrice.amount_incl_tax),i.optionBasePricePerItem+=parseFloat(b),i.optionOldPricePerItemExclTax+=parseFloat(e.oldPrice.amount_excl_tax)})},collectOptionPriceAndQty:function(i,p,c){var n;this.actualPriceInclTax=0,this.actualPriceExclTax=0;var m=this.base.options,r=this.base.isOneTimeOption(p),a=t(m.productQtySelector).val(),o=y.isUndefined(i.qty)?1:i.qty;this.getActualPrice(p,c,o),a==0&&(a=1);var d=this.actualPriceInclTax?this.actualPriceInclTax:parseFloat(i.prices.finalPrice.amount),f=this.actualPriceExclTax?this.actualPriceExclTax:parseFloat(i.prices.basePrice.amount),s=parseFloat(i.prices.oldPrice.amount_incl_tax),T=parseFloat(i.prices.oldPrice.amount_excl_tax),u=this.actualPriceInclTax?this.actualPriceInclTax:parseFloat(i.prices.finalPrice.amount),x=this.actualPriceExclTax?this.actualPriceExclTax:parseFloat(i.prices.basePrice.amount),P=parseFloat(i.prices.oldPrice.amount_incl_tax),g=parseFloat(i.prices.oldPrice.amount_excl_tax);const h=jsonConfig.optionPrices[F()];if(h&&h.oldPrice.amount>0){const l=h.finalPrice.amount/h.oldPrice.amount;u*=l,x*=l,d*=l,f*=l}!r&&(this.options.product_price_display_mode==="final_price"||this.options.additional_product_price_display_mode==="final_price")&&(d*=a,f*=a,s*=a,T*=a);const e=t('.mageworx-swatch-option.selected[data-option-id="'+p+'"][data-option-type-id="'+c+'"]').first(),b=e.closest(".product-option").find("span#doubletext");if(e.parents(".product-option").hasClass("selection_bottombar")&&t("body").hasClass("smallsystem")){var _=t(".selection_side_span"),I=t(".selection_side_span .options-list .radio"),j=e.parent().data("value");j=="rc3032"?(_.hide(),I.prop("disabled",!0).hide()):(_.show(),I.prop("disabled",!1).show());var w=t(".selection_clamp"),v=t(".selection_clamp .options-list .radio"),S=e.parent().data("value");S==t("body").hasClass("smallsystem")?(w.hide(),v.prop("disabled",!0).hide()):(w.show(),v.prop("disabled",!1).show())}if(e.parents(".product-option").hasClass("selection_bottombar")&&!t("body").hasClass("smallsystem")){var _=t(".selection_side_span"),w=t(".selection_clamp");_.hide(),w.hide()}e.closest(".product-option").find("span#value").removeClass("with-doubletext"),b.length&&b.remove();const R=e.data("option-code")===window.jsonConfig.bedieningOptionCode,B=(n=Object.values(window.jsonConfig.attributes).find(l=>l.code==="system_type"))==null?void 0:n.id,D=t('.swatch-attribute[data-attribute-id="'+B+'"]').find('.swatch-option.selected[data-option-id="'+window.jsonConfig.systemTypeTdbuOptionId+'"]').length>0;if(R&&D){u*=2,x*=2,P*=2,g*=2,d*=2,f*=2,s*=2,T*=2;const l=e.closest(".product-option").find("span#value");if(l.length&&u>0){const q=C.formatPrice(u,window.jsonConfig.currencyFormat);let Q=e.data("option-label");l.addClass("with-doubletext").append('<span id="doubletext">'+Q+" +"+q+"</span>")}}this.optionFinalPricePerItem+=u*o,this.optionBasePricePerItem+=x*o,this.optionOldPricePerItemInclTax+=P*o,this.optionOldPricePerItemExclTax+=g*o,this.optionFinalPrice+=d*o,this.optionBasePrice+=f*o,this.optionOldPriceInclTax+=s*o,this.optionOldPriceExclTax+=T*o},initProductPrice:function(i){if(!this.swatchesNotSubscribed){var p=t('div[data-role="swatch-options"]');p.on("swatch.initialized",()=>{t(window).trigger("swatches-click")}),this.swatchesNotSubscribed=!0}let c=F(),n=window.jsonConfig,m=(n==null?void 0:n.optionPrices)?n.optionPrices:{},r=m.hasOwnProperty(c)?m[c]:null;r&&(i.regular_price_excl_tax=r.baseOldPrice.amount,i.regular_price_incl_tax=r.oldPrice.amount,i.final_price_excl_tax=r.basePrice.amount,i.final_price_incl_tax=r.finalPrice.amount),this.productDefaultRegularPriceExclTax=i.regular_price_excl_tax,this.productDefaultRegularPriceInclTax=i.regular_price_incl_tax,this.productDefaultFinalPriceExclTax=i.final_price_excl_tax,this.productDefaultFinalPriceInclTax=i.final_price_incl_tax,this.productPerItemRegularPriceExclTax=i.regular_price_excl_tax,this.productPerItemRegularPriceInclTax=i.regular_price_incl_tax,this.productPerItemFinalPriceExclTax=i.final_price_excl_tax,this.productPerItemFinalPriceInclTax=i.final_price_incl_tax,this.productTotalRegularPriceExclTax=i.regular_price_excl_tax,this.productTotalRegularPriceInclTax=i.regular_price_incl_tax,this.productTotalFinalPriceExclTax=i.final_price_excl_tax,this.productTotalFinalPriceInclTax=i.final_price_incl_tax}};return function(i){return t.widget("mageworx.optionFeatures",i,E),t.mageworx.optionFeatures}});
