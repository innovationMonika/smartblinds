define(["jquery","underscore","Magento_Catalog/js/price-utils","getSwatchSelectedProductId","priceUtils"],function(o,w,b,I,v){"use strict";var O={calculateSelectedOptionsPrice:function(){this._super();var t=this,p=this.base.getFormElement(),r=this.base.options,n=o(r.optionsSelector,p);n.filter('input[type="hidden"]').each(function(h,c){var e=o(c),i=b.findOptionId(e),d=r.optionConfig&&r.optionConfig[i],f=e.val();if(e.closest(".field").css("display")==="none"){e.val("");return}var s=o(r.productQtySelector).val(),m=e.closest("#product_addtocart_form"),u=e.data("role"),x=m.data("mage-priceOptions").options.optionHandlers[u],P={};if(x){var g={};g[i]=d,P=x(e,g)}var _=P.hasOwnProperty(e.data("role"))?P[e.data("role")]:null,a=_||d.prices,T=a.basePrice.amount,F=a.finalPrice.amount;t.optionFinalPrice+=parseFloat(F)*s,t.optionOldPriceInclTax+=parseFloat(a.oldPrice.amount_incl_tax)*s,t.optionBasePrice+=parseFloat(T)*s,t.optionOldPriceExclTax+=parseFloat(a.oldPrice.amount_excl_tax)*s,t.optionFinalPricePerItem+=parseFloat(F),t.optionOldPricePerItemInclTax+=parseFloat(a.oldPrice.amount_incl_tax),t.optionBasePricePerItem+=parseFloat(T),t.optionOldPricePerItemExclTax+=parseFloat(a.oldPrice.amount_excl_tax)})},collectOptionPriceAndQty:function(t,p,r){var n;this.actualPriceInclTax=0,this.actualPriceExclTax=0;var h=this.base.options,c=this.base.isOneTimeOption(p),e=o(h.productQtySelector).val(),i=w.isUndefined(t.qty)?1:t.qty;this.getActualPrice(p,r,i),e==0&&(e=1);var d=this.actualPriceInclTax?this.actualPriceInclTax:parseFloat(t.prices.finalPrice.amount),f=this.actualPriceExclTax?this.actualPriceExclTax:parseFloat(t.prices.basePrice.amount),s=parseFloat(t.prices.oldPrice.amount_incl_tax),m=parseFloat(t.prices.oldPrice.amount_excl_tax),u=this.actualPriceInclTax?this.actualPriceInclTax:parseFloat(t.prices.finalPrice.amount),x=this.actualPriceExclTax?this.actualPriceExclTax:parseFloat(t.prices.basePrice.amount),P=parseFloat(t.prices.oldPrice.amount_incl_tax),g=parseFloat(t.prices.oldPrice.amount_excl_tax);const _=jsonConfig.optionPrices[I()];if(_&&_.oldPrice.amount>0){const l=_.finalPrice.amount/_.oldPrice.amount;u*=l,x*=l,d*=l,f*=l}!c&&(this.options.product_price_display_mode==="final_price"||this.options.additional_product_price_display_mode==="final_price")&&(d*=e,f*=e,s*=e,m*=e);const a=o('.mageworx-swatch-option.selected[data-option-id="'+p+'"][data-option-type-id="'+r+'"]').first(),T=a.closest(".product-option").find("span#doubletext");a.closest(".product-option").find("span#value").removeClass("with-doubletext"),T.length&&T.remove();const F=a.data("option-code")===window.jsonConfig.bedieningOptionCode,y=(n=Object.values(window.jsonConfig.attributes).find(l=>l.code==="system_type"))==null?void 0:n.id,E=o('.swatch-attribute[data-attribute-id="'+y+'"]').find('.swatch-option.selected[data-option-id="'+window.jsonConfig.systemTypeTdbuOptionId+'"]').length>0;if(F&&E){u*=2,x*=2,P*=2,g*=2,d*=2,f*=2,s*=2,m*=2;const l=a.closest(".product-option").find("span#value");if(l.length&&u>0){const C=v.formatPrice(u,window.jsonConfig.currencyFormat);let j=a.data("option-label");l.addClass("with-doubletext").append('<span id="doubletext">'+j+" +"+C+"</span>")}}this.optionFinalPricePerItem+=u*i,this.optionBasePricePerItem+=x*i,this.optionOldPricePerItemInclTax+=P*i,this.optionOldPricePerItemExclTax+=g*i,this.optionFinalPrice+=d*i,this.optionBasePrice+=f*i,this.optionOldPriceInclTax+=s*i,this.optionOldPriceExclTax+=m*i},initProductPrice:function(t){if(!this.swatchesNotSubscribed){var p=o('div[data-role="swatch-options"]');p.on("swatch.initialized",()=>{o(window).trigger("swatches-click")}),this.swatchesNotSubscribed=!0}let r=I(),n=window.jsonConfig,h=(n==null?void 0:n.optionPrices)?n.optionPrices:{},c=h.hasOwnProperty(r)?h[r]:null;c&&(t.regular_price_excl_tax=c.baseOldPrice.amount,t.regular_price_incl_tax=c.oldPrice.amount,t.final_price_excl_tax=c.basePrice.amount,t.final_price_incl_tax=c.finalPrice.amount),this.productDefaultRegularPriceExclTax=t.regular_price_excl_tax,this.productDefaultRegularPriceInclTax=t.regular_price_incl_tax,this.productDefaultFinalPriceExclTax=t.final_price_excl_tax,this.productDefaultFinalPriceInclTax=t.final_price_incl_tax,this.productPerItemRegularPriceExclTax=t.regular_price_excl_tax,this.productPerItemRegularPriceInclTax=t.regular_price_incl_tax,this.productPerItemFinalPriceExclTax=t.final_price_excl_tax,this.productPerItemFinalPriceInclTax=t.final_price_incl_tax,this.productTotalRegularPriceExclTax=t.regular_price_excl_tax,this.productTotalRegularPriceInclTax=t.regular_price_incl_tax,this.productTotalFinalPriceExclTax=t.final_price_excl_tax,this.productTotalFinalPriceInclTax=t.final_price_incl_tax}};return function(t){return o.widget("mageworx.optionFeatures",t,O),o.mageworx.optionFeatures}});
