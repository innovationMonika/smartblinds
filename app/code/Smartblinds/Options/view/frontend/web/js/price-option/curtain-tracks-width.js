define(["jquery","underscore","priceUtils","mage/translate","Smartblinds_Options/js/model/price-calculator","mage/validation","priceOptions","jquery-ui-modules/widget"],function(t,p,f,l,c){"use strict";var _=t(window);return t.widget("mage.priceOptionCurtainTracksWidth",{options:{formSelector:"#product_addtocart_form",widthFieldSelector:"input[data-role=curtain_tracks_width]"},_create:function(){this._initFields()._initEvents()._addValidatorMethod()._initOptionHandler()},_initFields:function(){return this.form=this.element.closest(this.options.formSelector),this.$form=t(this.form),this.$widthField=t(this.element.find(this.options.widthFieldSelector)),c.init(this.$widthField),this},_initEvents:function(){return this.$widthField.on("focusout",this._validateField.bind(this)),this},_validateField:function(n){t.validator.validateSingleElement(t(this.$widthField),{})},_initOptionHandler:function(){var n="curtain_tracks_width",i={optionHandlers:{}};return i.optionHandlers[n]=this._optionHandler.bind(this),this.form.priceOptions(i),this},_optionHandler:function(n,i){var r=f.findOptionId(n),e=i[r].prices,a="options["+r+"]",s={};let d=c.calculateCurtainTracksFinalPrice();if(d===null)return s[a]={},s;const u=c.calculateCurtainTracksRegularPrice();if(window.curtainTracks&&window!==null){let h=t(".mageworx-swatch-container .mageworx-swatch-option");if(h.length>0){let w=this;h.each(function(){let m=t(this);if(!m.hasClass("selected"))return;let o=m.attr("data-option-price");!o||(o=parseFloat(o),isNaN(o)||(d+=o))})}}return e.basePrice.amount=d,e.finalPrice.amount=d,e.oldPrice.amount=u,e.oldPrice.amount_excl_tax=u,e.oldPrice.amount_incl_tax=u,s[a]=e,s},_addValidatorMethod:function(){var n=this;return t.validator.addMethod("curtain-tracks",function(i,r){const e=t(r);if(i=i.replace(",","."),isNaN(i))return e.data("error-message",l("Wrong width provided")),!1;const a=parseInt(i);return a<50?(e.data("error-message",l("Your product is too small. The minimum width is 50 cm.")),!1):a>580?(e.data("error-message",l("Your product is too broad and therefore cannot be delivered. The maximum width is 580 cm.")),!1):!0},function(i,r){return t(r).data("error-message")}),this}}),t.mage.priceOptionCurtainTracksWidth});
