typeof AEC!="undefined"&&typeof AEC.EventDispatcher!="undefined"&&(AEC.GA4=(()=>({enabled:!1,transformCategories:function(t){let c={},e=t.split("/");if(e&&(c.item_category=e.shift(),e.length)){let i=1;e.forEach(r=>{c["item_category"+ ++i]=r})}return c},augmentCategories:function(t){let c=null;if(t.hasOwnProperty("category")&&(c=t.category,AEC.localStorage)){let r=AEC.Storage.reference().get();if(r)for(var e=0,i=r.length;e<i;e++)t.id.toString().toLowerCase()===r[e].id.toString().toLowerCase()&&(c=r[e].category)}return this.transformCategories(c)},augmentItem:function(t){let c={};return c.google_business_vertical="retail",Object.entries(t).forEach(([e,i])=>{["id","name","price","category","currency","variant","brand"].indexOf(e)===-1&&(c[e]=i)}),c}}))(),AEC.EventDispatcher.on("ec.cookie.impression.data",t=>{if(!AEC.GA4.enabled)return!0;var c=[];t.ecommerce.impressions.forEach(e=>{let i={item_id:e.id,item_name:e.name,item_list_name:t.ecommerce.actionField.list,item_list_id:t.ecommerce.actionField.list,item_brand:e.brand,price:e.price,quantity:e.quantity?e.quantity:1,index:e.position,currency:AEC.GA4.currency};Object.assign(i,i,AEC.GA4.augmentItem(e)),Object.assign(i,i,AEC.GA4.augmentCategories(e)),c.push(i)}),t.event="view_item_list",t.ecommerce.items=c}),AEC.EventDispatcher.on("ec.widget.view.data",t=>{if(!AEC.GA4.enabled)return!0;var c=[];t.ecommerce.impressions.forEach(e=>{let i={item_id:e.id,item_name:e.name,item_list_name:t.ecommerce.actionField.list,item_list_id:t.ecommerce.actionField.list,item_brand:e.brand,price:e.price,quantity:e.quantity?impression.quantity:1,index:e.position,currency:AEC.GA4.currency};Object.assign(i,i,AEC.GA4.augmentItem(e)),Object.assign(i,i,AEC.GA4.augmentCategories(e)),c.push(i)}),t.event="view_item_list",t.ecommerce.items=c}),AEC.EventDispatcher.on("ec.cookie.click.data",t=>{if(!AEC.GA4.enabled)return!0;let c=[];t.ecommerce.click.products.forEach(e=>{let i={item_id:e.id,item_name:e.name,item_brand:e.brand,item_list_name:t.ecommerce.click.actionField.list,quantity:e.quantity,index:e.position,price:e.price,currency:AEC.GA4.currency};Object.assign(i,i,AEC.GA4.augmentItem(e)),Object.assign(i,i,AEC.GA4.augmentCategories(e)),c.push(i)}),t.event="select_item",t.ecommerce.items=c}),AEC.EventDispatcher.on("ec.cookie.detail.data",t=>{if(!AEC.GA4.enabled)return!0;let c=[];t.ecommerce.detail.products.forEach(e=>{let i={item_name:e.name,item_id:e.id,item_brand:e.brand,item_list_name:t.ecommerce.detail.actionField.list,item_list_id:t.ecommerce.detail.actionField.list,quantity:e.quantity,price:e.price,currency:AEC.GA4.currency};Object.assign(i,i,AEC.GA4.augmentItem(e)),Object.assign(i,i,AEC.GA4.augmentCategories(e)),c.push(i)}),t.event="view_item",t.ecommerce.items=c,t.ecommerce.value=c[0].price}),AEC.EventDispatcher.on("ec.cookie.add.data",t=>{if(!AEC.GA4.enabled)return!0;let c=[];t.ecommerce.add.products.forEach(e=>{let i={item_id:e.id,item_name:e.name,item_brand:e.brand,item_list_id:t.ecommerce.add.actionField.list,item_list_name:t.ecommerce.add.actionField.list,quantity:e.quantity,price:e.price,currency:AEC.GA4.currency};e.hasOwnProperty("variant")&&(i.item_variant=e.variant),Object.assign(i,i,AEC.GA4.augmentItem(e)),Object.assign(i,i,AEC.GA4.augmentCategories(e)),c.push(i)}),t.event="add_to_cart",t.ecommerce.items=c}),AEC.EventDispatcher.on("ec.cookie.remove.item.data",t=>{if(!AEC.GA4.enabled)return!0;let c=[];t.ecommerce.remove.products.forEach(e=>{var i={item_id:e.id,item_name:e.name,item_brand:e.brand,item_list_id:t.ecommerce.remove.actionField.list,item_list_name:t.ecommerce.remove.actionField.list,quantity:e.quantity,price:e.price,currency:AEC.GA4.currency};e.hasOwnProperty("variant")&&(i.item_variant=e.variant),Object.assign(i,i,AEC.GA4.augmentItem(e)),Object.assign(i,i,AEC.GA4.augmentCategories(e)),c.push(i)}),t.event="remove_from_cart",t.ecommerce.items=c}),AEC.EventDispatcher.on("ec.cookie.update.item.data",t=>{if(!AEC.GA4.enabled)return!0;let c=[];t.event==="addToCart"?(t.ecommerce.add.products.forEach(e=>{var i={item_id:e.id,item_name:e.name,item_brand:e.brand,item_list_id:t.ecommerce.add.actionField.list,item_list_name:t.ecommerce.add.actionField.list,quantity:e.quantity,price:e.price,currency:AEC.GA4.currency};e.hasOwnProperty("variant")&&(i.item_variant=e.variant),Object.assign(i,i,AEC.GA4.augmentItem(e)),Object.assign(i,i,AEC.GA4.augmentCategories(e)),c.push(i)}),t.event="add_to_cart"):(t.ecommerce.remove.products.forEach(e=>{var i={item_id:e.id,item_name:e.name,item_brand:e.brand,item_list_id:t.ecommerce.remove.actionField.list,item_list_name:t.ecommerce.remove.actionField.list,quantity:e.quantity,price:e.price,currency:AEC.GA4.currency};e.hasOwnProperty("variant")&&(i.item_variant=e.variant),Object.assign(i,i,AEC.GA4.augmentItem(e)),Object.assign(i,i,AEC.GA4.augmentCategories(e)),c.push(i)}),t.event="remove_from_cart"),t.ecommerce.items=c}),AEC.EventDispatcher.on("ec.checkout.step.data",t=>{if(!AEC.GA4.enabled)return!0}),AEC.EventDispatcher.on("ec.cookie.checkout.step.data",t=>{if(!AEC.GA4.enabled)return!0;let c=[],e=0;t.ecommerce.checkout.products.forEach(i=>{var r={item_id:i.id,item_name:i.name,item_brand:i.brand,item_list_id:i.list,item_list_name:i.list,quantity:i.quantity,price:i.price,currency:AEC.GA4.currency};i.hasOwnProperty("variant")&&(r.item_variant=i.variant),Object.assign(r,r,AEC.GA4.augmentItem(i)),Object.assign(r,r,AEC.GA4.augmentCategories(i)),c.push(r),e+=i.price*i.quantity}),Number(t.ecommerce.checkout.actionField.step)==1?t.event="begin_checkout":t.event="checkout",t.ecommerce.items=c,t.ecommerce.value=window.hasOwnProperty("checkoutConfig")?window.checkoutConfig.totalsData.base_grand_total:e}),AEC.EventDispatcher.on("ec.checkout.step.option.data",t=>{if(!AEC.GA4.enabled)return!0;switch(parseInt(t.ecommerce.checkout_option.actionField.step)){case AEC.Const.CHECKOUT_STEP_SHIPPING:t.event="add_shipping_info",AEC.GA4.quote.hasOwnProperty("coupon")&&(t.ecommerce.coupon=AEC.GA4.quote.coupon),t.ecommerce.currency=AEC.GA4.currency,t.ecommerce.items=AEC.Checkout.data.ecommerce.items,t.ecommerce.shipping_tier=t.ecommerce.checkout_option.actionField.option,delete t.ecommerce.checkout_option;break;case AEC.Const.CHECKOUT_STEP_PAYMENT:t.event="add_payment_info",AEC.GA4.quote.hasOwnProperty("coupon")&&(t.ecommerce.coupon=AEC.GA4.quote.coupon),t.ecommerce.currency=AEC.GA4.currency,t.ecommerce.items=AEC.Checkout.data.ecommerce.items,t.ecommerce.payment_type=t.ecommerce.checkout_option.actionField.option,delete t.ecommerce.checkout_option;break}}),AEC.EventDispatcher.on("ec.cookie.purchase.data",t=>{if(!AEC.GA4.enabled)return!0;let c=[];t.ecommerce.purchase.products.forEach(e=>{let i={item_id:e.id,item_name:e.name,item_brand:e.brand,quantity:e.quantity,price:e.price,currency:AEC.GA4.currency};e.hasOwnProperty("variant")&&(i.item_variant=e.variant),Object.assign(i,i,AEC.GA4.augmentItem(e)),Object.assign(i,i,AEC.GA4.augmentCategories(e)),c.push(i)}),t.event=AEC.GA4.conversion_event,t.ecommerce.purchase.items=c,t.ecommerce.purchase.transaction_id=t.ecommerce.purchase.actionField.id,t.ecommerce.purchase.affiliation=t.ecommerce.purchase.actionField.id,t.ecommerce.purchase.value=t.ecommerce.purchase.actionField.revenue,t.ecommerce.purchase.tax=t.ecommerce.purchase.actionField.tax,t.ecommerce.purchase.shipping=t.ecommerce.purchase.actionField.shipping,t.ecommerce.purchase.currency=t.ecommerce.currencyCode,t.ecommerce.purchase.coupon=t.ecommerce.purchase.actionField.coupon}),AEC.EventDispatcher.on("ec.add.wishlist",(t,c)=>{if(!AEC.GA4.enabled)return!0;let e=JSON.parse(c.attributes);t.event="add_to_wishlist",t.ecommerce={items:e.items}}),AEC.EventDispatcher.on("ec.add.compare",(t,c)=>{if(!AEC.GA4.enabled)return!0;let e=JSON.parse(c.attributes);t.event="add_to_compare",t.ecommerce={items:e.items}}),AEC.EventDispatcher.on("ec.cookie.promotion.entity",(t,c)=>{if(!AEC.GA4.enabled)return!0}),AEC.EventDispatcher.on("ec.cookie.promotion.click",(t,c)=>{if(!AEC.GA4.enabled)return!0;const e=Object.fromEntries(Object.entries(Object.assign({},c.element.dataset)).filter(([i,r])=>["creative_name","creative_slot","location_id","promotion_id","promotion_name"].includes(i)));e.items=[],t.ecommerce.hasOwnProperty("promoClick")&&t.ecommerce.promoClick.promotions.forEach(i=>{e.items.push({item_id:i.id,item_name:i.name,promotion_id:i.id,promotion_name:i.name,creative_name:i.creative,creative_slot:i.position})}),Object.entries(e).forEach(([i,r])=>{t.ecommerce[i]=r}),t.event="select_promotion"}),AEC.EventDispatcher.on("ec.cookie.promotion.data",t=>{if(!AEC.GA4.enabled)return!0;const c={};c.items=[],t.ecommerce.hasOwnProperty("promoView")&&t.ecommerce.promoView.promotions.forEach(e=>{c.items.push({item_id:e.id,item_name:e.name,promotion_id:e.id,promotion_name:e.name,creative_name:e.creative,creative_slot:e.position})}),Object.entries(c).forEach(([e,i])=>{t.ecommerce[e]=i}),t.event="view_promotion"}));
